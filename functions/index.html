<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,500,700" rel="stylesheet">
    <title>Let's Bring It Down</title>
    <style>
      body {
        margin: 0;
        font-family: 'Montserrat', sans-serif;
        background: #ff485e;
      }
      .above-fold {
        color: white;
        height: 100vh;
        min-height: 500px;
        position: relative;
      }

      .header {
        padding: 1.5rem;
        display: grid;
        grid-template-columns: minmax(150px, 300px) auto;
        grid-gap: 1.5rem;
        justify-content: space-between;
        align-items: center;
      }
      .header-title, .header-faq, .header-states {
        color: white;
        text-decoration: none;
      }
      .header-title img {
        display: block;
        width: 100%;
      }
      .header-title span {
        display: inline-block;
        color: #ff485e;
        background-color: white;
        padding: 2px 3px;
        text-transform: uppercase;
      }
      .header-menu {
        display: flex;
        font-weight: bold;
        align-items: center;
      }
      .header-faq, .header-states {
        font-size: 20px;
      }
      .header-menu > :first-child {
        margin-right: 1.5rem;
      }
      @media (max-width: 600px) {
        .header-faq, .header-states {
          font-size: 16px;
        }
        .header-menu > :first-child {
          margin-right: 0.75rem;
        }
      }

      .flip-card {
        width: 100%;
        height: 140px;
        perspective: 1500px;
      }
       .flip-card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        text-align: center;
        transition: transform 0.8s;
        transform-style: preserve-3d;
        -moz-backface-visibility: hidden;
      }
      .flip-card-flipped .flip-card-inner {
        transform: rotateY(-180deg);
      }
      .flip-card-front, .flip-card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden; /* Safari */
        backface-visibility: hidden;
      }
      .flip-card-back {
        transform: rotateY(180deg);
      }
  
      .center {
        text-align: center;
        position: absolute;
        left: 15px;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
      }
      .center-number {
        font-size: 100px;
        font-weight: bold;
        line-height: 1;
      }
      .center-infection-rate,
      .center-region-name {
        font-size: 18px;
        font-weight: bold;
        text-transform: uppercase;
        white-space: nowrap;
        letter-spacing: 1px;
      }
      .center-infection-rate {
        line-height: 1;
      }
      .center-infection-rate span {
        font-size: 34px;
      }
      .center-region-name {
        margin-top: 5px;
      }
      .center-arrow-wrapper {
        position: absolute;
        top: -7px;
        left: 50%;
        bottom: 0;
        transform: translateX(-50%);
        width: 97vw;
        max-width: 340px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }
      .center-yesterday-arrow, 
      .center-tomorrow-arrow {
        width: 15px;
        cursor: pointer;
        transition: opacity 0.3s linear;
      }
      .center-last-update {
        font-size: 17px;
        font-weight: 500;
        margin-top: 80px;
      }
      .center-region-image {
        position: absolute;
        max-width: 900px;
        width: 100%;
        max-height: 70vh;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }

      .go-down {
        position: absolute;
        width: 30px;
        height: 30px;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
      }
      .go-down svg {
        fill: white;
      }
      @media (max-height: 500px) {
        .go-down {
          display: none;
        }
      }

      .content {
        padding: 1.5em;
      }
      .content-inner {
        max-width: 40em;
        margin: 0 auto;
      }
      .content-title {
        font-size: 26px;
        margin: 0 0 0.75rem 0;
        line-height: 1;
      }

      .states {
        background: white;
        text-align: left;
        padding: 1.5em 0;
      }
      .states .content-title {
        text-align: center;
      }

      .states-link {
        display: block;
        text-decoration: none;
        color: black;
        padding: 15px;
        border-bottom: 2px solid #eee;
      }
      .states-inner-row {
        display: grid;
        grid-template-columns: 1fr 1fr 10px;
      }
      .states-name {
        font-weight: bold;
      }
      .states-caret {
        width: 10px;
      }


      .faq {
        background-color: #1c2458;
        color: white;
      }
      .faq-content h3, .faq-content p {
        line-height: 1.5;
      }
      .faq-content h3 {
        font-size: 16px;
        font-weight: bold;
        margin: 0;
      }
      .faq-content p {
        margin: 0 0 1.5em 0;
      }
      .faq a {
        color: #a0e5ff;
      }

      .icons-twitter {
        margin-right: 10px;
      }
      .icons-twitter, 
      .icons-instagram {
        text-decoration: none;
      }
      .icons-twitter img,
      .icons-instagram img {
        width: 40px;
      }

    </style>
  </head>
  <body>
    <div id="root"></div>

    <main class="above-fold">
      <header class="header">
        <a class="header-title" href="/">
          <img src="logo.svg" alt="Let's Bring It Down" />  
        </a>
        <div class="header-menu">
          <a class="header-states" href="#states">States</a>
          <a class="header-faq" href="#faq">FAQ</a>
        </div>
      </header>

      <div class="center">
        <img id="primary-region-outline" class="center-region-image" alt="Picture of region" />
        <div id="center-card" class="flip-card">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <div class="center-infection-rate">
                Infection Spread Rate<br><span>Today</span>
              </div>
              <div id="primary-infection-rate" class="center-number"></div>
              <div primary-region class="center-region-name"></div>
            </div>
            <div class="flip-card-back">
              <div class="center-infection-rate">
                Infection Spread Rate<br><span>Yesterday</span>
              </div>
              <div id="yesterday-infection-rate" class="center-number"></div>
              <div primary-region class="center-region-name"></div>
            </div>
          </div>
        </div>
        <div class="center-arrow-wrapper">
          <img 
            id="yesterday-arrow"
            class="center-yesterday-arrow"
            src="angle-left-solid.svg"
            alt="View yesterday"
          />
          <img 
            id="tomorrow-arrow"
            class="center-tomorrow-arrow"
            src="angle-right-white.svg"
            alt="View tomorrow"
            style="opacity: 0;"
          />
        </div>
        <div id="last-update" class="center-last-update"></div>
      </div>

      <a class="go-down" href="#states">
        <svg viewBox="0 0 1024 1024"><path d="M512 64q91 0 174 35 81 34 143 96t96 143q35 83 35 174t-35 174q-34 81-96 143t-143 96q-83 35-174 35t-174-35q-81-34-143-96T99 686q-35-83-35-174t35-174q34-81 96-143t143-96q83-35 174-35zm0-64Q373 0 255 68.5T68.5 255 0 512t68.5 257T255 955.5t257 68.5 257-68.5T955.5 769t68.5-257-68.5-257T769 68.5 512 0zm22 695l258-257q9-10 9-23t-9-23q-10-9-23-9t-23 9L511 627 278 394q-10-10-23-10t-23 10q-9 9-9 22t9 23l256 256q10 9 23 9t23-9z"></path></svg>
      </a>
    </main>

    <div class="states" id="states">
      <div class="content-inner">
        <h2 class="content-title">States</h2>
      </div>
      <div class="states-table" id="states-body">
      </div>
    </div>

    <div class="faq content" id="faq">
      <div class="content-inner">
        <h2 class="content-title">FAQ</h2>
        <div class="faq-content" id="faq-content"></div>

        <div class="icons">
          <a class="icons-twitter" target="_blank" href="https://twitter.com/letsbringitdown">
            <img alt="Visit our Twitter" src="twitter.svg" />
          </a>
          <a class="icons-instagram" target="_blank" href="https://www.instagram.com/letsbringitdown/">
            <img alt="Visit our Instagram" src="instagram.svg" />
          </a>
        </div>
      </div>
    </div>

    <script src="smooth-scroll.min.js"></script>

    <script>
      // Will be replaced with a json string by the cloud function
      const rawData = JSON.parse(RAW_DATA_FROM_SERVER)

      // Populate primary region data with the United States as a fallback
      const slug = window.location.pathname.slice(1)
      const region = rawData.regions.find(data => data.slug === slug) || rawData.regions[0]
      document.querySelectorAll('[primary-region]').forEach(element => {
        element.textContent = region.name
      })
      document.querySelector('#primary-infection-rate').textContent = region.dailyInfectionRates[0].formattedValue
      document.querySelector('#yesterday-infection-rate').textContent = region.dailyInfectionRates[1].formattedValue
      if (region.image) {
        document.querySelector('#primary-region-outline').setAttribute('src', region.image) 
      } else {
        document.querySelector('#primary-region-outline').style.display = 'none'
      }
      document.querySelector('#last-update').textContent = rawData.lastUpdateFormatted
      document.querySelector('#faq-content').innerHTML = rawData.faqHtml

      document.querySelector('#yesterday-arrow').addEventListener('click', () => {
        document.querySelector('#center-card').classList.add('flip-card-flipped')
        document.querySelector('#yesterday-arrow').style.opacity = 0
        document.querySelector('#tomorrow-arrow').style.opacity = 1
      })
      document.querySelector('#tomorrow-arrow').addEventListener('click', () => {
        document.querySelector('#center-card').classList.remove('flip-card-flipped')
        document.querySelector('#tomorrow-arrow').style.opacity = 0
        document.querySelector('#yesterday-arrow').style.opacity = 1
      })

      // Populate states table
      rawData.regions.forEach(region => {
        if (region.name === 'United States') {
          return
        }
        const row = document.createElement('div')
        row.classList.add('states-row')
        row.innerHTML = `
          <a class="states-link" href="/${region.slug}">
            <div class="content-inner states-inner-row">
              <div class="states-name">${region.name}</div>
              <div class="states-infection-rate">${region.dailyInfectionRates[0].formattedValue}</div>
              <img class="states-caret" src="angle-right-solid.svg" alt="View region" />
            </div>
          </a>
        `
        document.querySelector('#states-body').appendChild(row)
      })

      // Smooth scrolling page links
      document.querySelectorAll('a').forEach(element => {
        element.addEventListener('click', event => {
          const anchors = ['#faq', '#states']
          const currentUrl = element.attributes.href.value
          if (!anchors.includes(currentUrl)) return
          event.preventDefault()
          document.querySelector(currentUrl).scrollIntoView({ behavior: 'smooth' })
        })

        // Make external links open in a new tab
        const firstCharacterOfLink = element.getAttribute('href').slice(0, 1)
        if (firstCharacterOfLink !== '/' && firstCharacterOfLink !== '#') {
          element.setAttribute('target', '_blank')
        }
      })
    </script>

    <script src="bundle/clientIndex.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162041222-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-162041222-1');
    </script>
  </body>
</html>