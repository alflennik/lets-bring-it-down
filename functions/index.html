<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,500,700" rel="stylesheet">
    <link href="bundle/clientIndex.css" rel="stylesheet">
    <title>Let's Bring It Down</title>
  </head>
  <body>
    <div id="root"></div>

    <main class="above-fold">
      <header class="header">
        <a class="header-title" href="/">
          <img src="logo.svg" alt="Let's Bring It Down" />  
        </a>
        <div class="header-menu">
          <a class="header-states" href="#states">States</a>
          <a class="header-faq" href="#faq">FAQ</a>
        </div>
      </header>

      <div class="center">
        <img id="primary-region-outline" class="center-region-image" alt="Picture of region" />
        <div id="center-card" class="flip-card">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <div class="center-infection-rate">
                Infection Spread Rate<br><span>Today</span>
              </div>
              <div id="primary-infection-rate" class="center-number"></div>
              <div primary-region class="center-region-name"></div>
            </div>
            <div class="flip-card-back">
              <div class="center-infection-rate">
                Infection Spread Rate<br><span>Yesterday</span>
              </div>
              <div id="yesterday-infection-rate" class="center-number"></div>
              <div primary-region class="center-region-name"></div>
            </div>
          </div>
        </div>
        <div class="center-arrow-wrapper">
          <img 
            id="yesterday-arrow"
            class="center-yesterday-arrow"
            src="angle-left-solid.svg"
            alt="View yesterday"
          />
          <img 
            id="tomorrow-arrow"
            class="center-tomorrow-arrow"
            src="angle-right-white.svg"
            alt="View tomorrow"
            style="opacity: 0;"
          />
        </div>
        <div id="last-update" class="center-last-update"></div>
      </div>

      <a class="go-down" href="#states">
        <svg viewBox="0 0 1024 1024"><path d="M512 64q91 0 174 35 81 34 143 96t96 143q35 83 35 174t-35 174q-34 81-96 143t-143 96q-83 35-174 35t-174-35q-81-34-143-96T99 686q-35-83-35-174t35-174q34-81 96-143t143-96q83-35 174-35zm0-64Q373 0 255 68.5T68.5 255 0 512t68.5 257T255 955.5t257 68.5 257-68.5T955.5 769t68.5-257-68.5-257T769 68.5 512 0zm22 695l258-257q9-10 9-23t-9-23q-10-9-23-9t-23 9L511 627 278 394q-10-10-23-10t-23 10q-9 9-9 22t9 23l256 256q10 9 23 9t23-9z"></path></svg>
      </a>
    </main>

    <div class="states" id="states">
      <div class="content-inner">
        <h2 class="content-title">States</h2>
      </div>
      <div class="states-table" id="states-body">
      </div>
    </div>

    <div class="faq content" id="faq">
      <div class="content-inner">
        <h2 class="content-title">FAQ</h2>
        <div class="faq-content" id="faq-content"></div>

        <div class="icons">
          <a class="icons-twitter" target="_blank" href="https://twitter.com/letsbringitdown">
            <img alt="Visit our Twitter" src="twitter.svg" />
          </a>
          <a class="icons-instagram" target="_blank" href="https://www.instagram.com/letsbringitdown/">
            <img alt="Visit our Instagram" src="instagram.svg" />
          </a>
        </div>
      </div>
    </div>

    <script src="smooth-scroll.min.js"></script>

    <script>
      // Will be replaced with a json string by the cloud function
      const rawData = JSON.parse(RAW_DATA_FROM_SERVER)

      // Populate primary region data with the United States as a fallback
      const slug = window.location.pathname.slice(1)
      const region = rawData.regions.find(data => data.slug === slug) || rawData.regions[0]
      document.querySelectorAll('[primary-region]').forEach(element => {
        element.textContent = region.name
      })
      document.querySelector('#primary-infection-rate').textContent = region.dailyInfectionRates[0].formattedValue
      document.querySelector('#yesterday-infection-rate').textContent = region.dailyInfectionRates[1].formattedValue
      if (region.image) {
        document.querySelector('#primary-region-outline').setAttribute('src', region.image) 
      } else {
        document.querySelector('#primary-region-outline').style.display = 'none'
      }
      document.querySelector('#last-update').textContent = rawData.lastUpdateFormatted
      document.querySelector('#faq-content').innerHTML = rawData.faqHtml

      document.querySelector('#yesterday-arrow').addEventListener('click', () => {
        document.querySelector('#center-card').classList.add('flip-card-flipped')
        document.querySelector('#yesterday-arrow').style.opacity = 0
        document.querySelector('#tomorrow-arrow').style.opacity = 1
      })
      document.querySelector('#tomorrow-arrow').addEventListener('click', () => {
        document.querySelector('#center-card').classList.remove('flip-card-flipped')
        document.querySelector('#tomorrow-arrow').style.opacity = 0
        document.querySelector('#yesterday-arrow').style.opacity = 1
      })

      // Populate states table
      rawData.regions.forEach(region => {
        if (region.name === 'United States') {
          return
        }
        const row = document.createElement('div')
        row.classList.add('states-row')
        row.innerHTML = `
          <a class="states-link" href="/${region.slug}">
            <div class="content-inner states-inner-row">
              <div class="states-name">${region.name}</div>
              <div class="states-infection-rate">${region.dailyInfectionRates[0].formattedValue}</div>
              <img class="states-caret" src="angle-right-solid.svg" alt="View region" />
            </div>
          </a>
        `
        document.querySelector('#states-body').appendChild(row)
      })

      // Smooth scrolling page links
      document.querySelectorAll('a').forEach(element => {
        element.addEventListener('click', event => {
          const anchors = ['#faq', '#states']
          const currentUrl = element.attributes.href.value
          if (!anchors.includes(currentUrl)) return
          event.preventDefault()
          document.querySelector(currentUrl).scrollIntoView({ behavior: 'smooth' })
        })

        // Make external links open in a new tab
        const firstCharacterOfLink = element.getAttribute('href').slice(0, 1)
        if (firstCharacterOfLink !== '/' && firstCharacterOfLink !== '#') {
          element.setAttribute('target', '_blank')
        }
      })
    </script>

    <script src="bundle/clientIndex.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162041222-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-162041222-1');
    </script>
  </body>
</html>